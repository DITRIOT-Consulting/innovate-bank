def remote = [:]
remote.name = "node"
remote.host = "192.168.0.78"
remote.allowAnyHosts = true

node {
    checkout scm
    withCredentials([usernamePassword(credentialsId: '43aeb327-5719-49ec-af8a-5f1ab2fe92aa', passwordVariable: 'password', usernameVariable: 'userName')]) {
        remote.user = userName
        remote.password = password

        stage("Init") {
            sshCommand remote: remote, command: 'export APPDATA="C:\\Users\\Administrator\\AppData\\Roaming"; npm'
        }
        stage("Build") {
            sshCommand remote: remote, command: "npm install"
        }
        stage("Test") {
            sshCommand remote: remote, command: 'npm test'
        }
        stage("Deploy") {
            sshCommand remote: remote, command: 'npm start'
        }
    }
}
